<!-- Import Feature Modal -->
<div class="modal-backdrop" *ngIf="showImportFeatureModal()" (click)="closeImportFeatureModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Import Feature from Azure DevOps</h3>
      <button type="button" class="modal-close" (click)="closeImportFeatureModal()">×</button>
    </div>
    <div class="modal-body">
      <div class="modal-label">Feature ID (User Story ID) *</div>
      <input
        class="modal-input"
        type="text"
        [(ngModel)]="importFeatureId"
        placeholder="e.g., 12345"
      />

      <div class="modal-label">Organization *</div>
      <input
        class="modal-input"
        type="text"
        [value]="board()?.organization || ''"
        disabled
        placeholder="Auto-populated from board"
      />

      <div class="modal-label">Project *</div>
      <input
        class="modal-input"
        type="text"
        [value]="board()?.project || ''"
        disabled
        placeholder="Auto-populated from board"
      />

      <div class="modal-label">Personal Access Token (PAT) *</div>
      <input
        class="modal-input"
        type="password"
        [(ngModel)]="importPat"
        placeholder="Enter your Azure DevOps PAT"
      />

      <div class="checkbox-group">
        <label>
          <input 
            type="checkbox" 
            [(ngModel)]="rememberPatForImport" />
          Remember PAT for 10 minutes
        </label>
      </div>

      <div *ngIf="importError()" class="error-message-inline">
        {{ importError() }}
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" type="button" (click)="closeImportFeatureModal()" [disabled]="importLoading()">
        Cancel
      </button>
      <button class="btn-primary" type="button" (click)="importFeatureFromAzure()" [disabled]="importLoading()">
        {{ importLoading() ? 'Importing...' : 'Import Feature' }}
      </button>
    </div>
  </div>
</div>

<!-- Refresh Feature Modal -->
<div class="modal-backdrop" *ngIf="showRefreshFeatureModal()" (click)="closeRefreshFeatureModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Refresh Feature from Azure DevOps</h3>
      <button type="button" class="modal-close" (click)="closeRefreshFeatureModal()">×</button>
    </div>
    <div class="modal-body">
      <div class="modal-label">Feature</div>
      <input
        class="modal-input"
        type="text"
        [value]="selectedFeature()?.title || ''"
        disabled
      />

      <div class="modal-label">Azure ID</div>
      <input
        class="modal-input"
        type="text"
        [value]="selectedFeature()?.azureId || ''"
        disabled
      />

      <div class="modal-label">Organization</div>
      <input
        class="modal-input"
        type="text"
        [value]="board()?.organization || ''"
        disabled
        placeholder="Auto-populated from board"
      />

      <div class="modal-label">Project</div>
      <input
        class="modal-input"
        type="text"
        [value]="board()?.project || ''"
        disabled
        placeholder="Auto-populated from board"
      />

      <div class="modal-label">Personal Access Token (PAT) *</div>
      <input
        class="modal-input"
        type="password"
        [(ngModel)]="refreshPat"
        placeholder="Enter your Azure DevOps PAT"
      />

      <div class="checkbox-group">
        <label>
          <input 
            type="checkbox" 
            [(ngModel)]="rememberPatForRefresh" />
          Remember PAT for 10 minutes
        </label>
      </div>

      <div *ngIf="refreshError()" class="error-message-inline">
        {{ refreshError() }}
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" type="button" (click)="closeRefreshFeatureModal()" [disabled]="refreshLoading()">
        Cancel
      </button>
      <button class="btn-primary" type="button" (click)="refreshFeatureFromAzure()" [disabled]="refreshLoading()">
        {{ refreshLoading() ? 'Refreshing...' : 'Refresh Feature' }}
      </button>
    </div>
  </div>
</div>

<!-- Delete Feature Modal -->
<div class="modal-backdrop" *ngIf="showDeleteFeatureModal()" (click)="closeDeleteFeatureModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Delete Feature</h3>
      <button type="button" class="modal-close" (click)="closeDeleteFeatureModal()">×</button>
    </div>
    <div class="modal-body">
      <div class="modal-label">Feature</div>
      <input
        class="modal-input"
        type="text"
        [value]="featureToDelete()?.title || ''"
        disabled
      />

      <div class="modal-label">Azure ID</div>
      <input
        class="modal-input"
        type="text"
        [value]="featureToDelete()?.azureId || ''"
        disabled
      />

      <div class="warning-text">
        This will delete the feature and all associated user stories. This action cannot be undone.
      </div>

      <div *ngIf="deleteError()" class="error-message-inline">
        {{ deleteError() }}
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" type="button" (click)="closeDeleteFeatureModal()" [disabled]="deleteLoading()">
        Cancel
      </button>
      <button class="btn-danger" type="button" (click)="deleteFeature()" [disabled]="deleteLoading()">
        {{ deleteLoading() ? 'Deleting...' : 'Delete Feature' }}
      </button>
    </div>
  </div>
</div>

<!-- Finalization Confirmation Modal -->
<div class="modal-backdrop" *ngIf="showFinalizeConfirmation()" (click)="closeFinalizeConfirmation()">
  <div class="modal modal-finalize" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Finalize Board</h3>
      <button type="button" class="modal-close" (click)="closeFinalizeConfirmation()" [disabled]="finalizationLoading()">×</button>
    </div>
    <div class="modal-body">
      <p class="finalize-info">
        Finalizing marks the board as <strong>ready for execution</strong>. You will not be able to:
      </p>
      <ul class="finalize-restrictions">
        <li>❌ Add new features</li>
        <li>❌ Add new team members</li>
        <li>❌ Add new user stories (except via refresh to Sprint 0)</li>
      </ul>
      <p>You will still be able to:</p>
      <ul class="finalize-allowed">
        <li>✅ Move user stories between sprints</li>
        <li>✅ Reorder features</li>
        <li>✅ Update capacity allocations</li>
        <li>✅ Refresh features from Azure DevOps</li>
      </ul>

      <div *ngIf="finalizationWarnings().length > 0" class="warning-section">
        <h4>⚠️ Warnings:</h4>
        <ul class="warnings-list">
          <li *ngFor="let warning of finalizationWarnings()">{{ warning }}</li>
        </ul>
      </div>

      <div *ngIf="finalizationError()" class="error-message-inline">
        {{ finalizationError() }}
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" type="button" (click)="closeFinalizeConfirmation()" [disabled]="finalizationLoading()">
        Cancel
      </button>
      <button class="btn-finalize-confirm" type="button" (click)="finalizeBoard()" [disabled]="finalizationLoading()">
        {{ finalizationLoading() ? 'Finalizing...' : 'Yes, Finalize Board' }}
      </button>
    </div>
  </div>
</div>

<!-- Operation Blocked Error Banner -->
<div *ngIf="operationBlockedError()" class="operation-blocked-banner">
  <span class="error-icon">⚠️</span>
  <span class="error-text">{{ operationBlockedError() }}</span>
  <button type="button" class="banner-close" (click)="operationBlockedError.set('')">×</button>
</div>
