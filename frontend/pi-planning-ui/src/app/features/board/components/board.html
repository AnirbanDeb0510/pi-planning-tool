<!-- Loading State -->
<div *ngIf="loading()" class="loading-overlay">
  <div class="loading-spinner"></div>
  <p>{{ MESSAGES.BOARD.LOADING }}</p>
</div>

<!-- Error State -->
<div *ngIf="error()" class="error-overlay">
  <div class="error-message">
    <h2>{{ MESSAGES.ERROR.TITLE }}</h2>
    <p>{{ error() }}</p>
    <button class="btn-primary" (click)="boardService.clearError(); router.navigate(['/boards'])">
      {{ LABELS.BUTTONS.GO_TO_BOARDS }}
    </button>
  </div>
</div>

<!-- Finalized Board Banner -->
<div *ngIf="board()?.isFinalized" class="finalized-board-banner">
  <span class="finalized-icon">✓</span>
  <span class="finalized-text">{{ MESSAGES.BOARD.FINALIZED }}</span>
  <button 
    type="button" 
    class="restore-banner-btn"
    (click)="restoreBoard()"
    title="{{ TOOLTIPS.BOARD.RESTORE }}">
    {{ LABELS.BUTTONS.RESTORE_PLAIN }}
  </button>
</div>

<!-- PAT Validation Modal -->
<div class="modal-backdrop" *ngIf="showPatModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ LABELS.HEADERS.PAT_REQUIRED }}</h3>
      <button type="button" class="modal-close" (click)="closePatModal()">×</button>
    </div>
    <div class="modal-body">
      <p class="pat-info">
        {{ MESSAGES.PAT.INFO }}
      </p>
      <div class="form-group">
        <label for="pat-input">{{ LABELS.FIELDS.PAT_INPUT }}</label>
        <input
          id="pat-input"
          type="password"
          class="modal-input"
          [value]="patModalInput()"
          (input)="patModalInput.set($any($event.target).value)"
          placeholder="{{ PLACEHOLDERS.PAT }}"
          [disabled]="patValidationLoading()"
        />
        <small class="pat-hint">{{ MESSAGES.PAT.HINT }}</small>
      </div>
      <div *ngIf="patValidationError()" class="form-error">
        {{ patValidationError() }}
      </div>
    </div>
    <div class="modal-footer">
      <button
        class="btn-secondary"
        type="button"
        (click)="closePatModal()"
        [disabled]="patValidationLoading()"
      >
        {{ LABELS.BUTTONS.CANCEL }}
      </button>
      <button
        class="btn-primary"
        type="button"
        (click)="validatePat()"
        [disabled]="patValidationLoading()"
      >
        {{ patValidationLoading() ? LABELS.BUTTONS.VALIDATING : LABELS.BUTTONS.VALIDATE_OPEN }}
      </button>
    </div>
  </div>
</div>

<!-- Board Content -->
<div *ngIf="!loading() && !error() && board() && patValidated()">
  <div class="board-container" (mousemove)="onMouseMove($event)">
    <!-- Board Header (Dev/Test Toggle) -->
    <app-board-header [board]="board" [parent]="this" [showDevTest]="showDevTest"></app-board-header>

    <!-- Team Bar -->
    <app-team-bar [board]="board" [parent]="this"></app-team-bar>

    <!-- Board Content Grid -->
    <div class="board-content">
      <!-- Capacity Row -->
      <app-capacity-row [board]="board" [parent]="this" [showDevTest]="showDevTest"></app-capacity-row>

      <!-- Sprint Header -->
      <app-sprint-header [board]="board" [parent]="this" [showDevTest]="showDevTest"></app-sprint-header>

      <!-- Feature Rows -->
      <div
        class="feature-rows"
        cdkDropList
        cdkDropListOrientation="vertical"
        [cdkDropListData]="board()!.features"
        (cdkDropListDropped)="dropFeature($event)"
      >
        <app-feature-row
          *ngFor="let feature of board()!.features"
          [feature]="feature"
          [board]="board"
          [showDevTest]="showDevTest"
          [parent]="this"
          cdkDrag
          [cdkDragData]="feature"
          [title]="board()?.isFinalized ? TOOLTIPS.BOARD.FINALIZED_REORDER : ''"
        ></app-feature-row>
      </div>
    </div>

    <!-- Floating cursor name -->
    <div class="cursor-label" [ngStyle]="{ top: cursorY() + 'px', left: cursorX() + 'px' }">
      {{ cursorName() }}
    </div>
  </div>

  <!-- Modals Component -->
  <app-board-modals [board]="board" [parent]="this"></app-board-modals>
</div>
