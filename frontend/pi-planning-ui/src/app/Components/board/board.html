<!-- Dev-Test Toggle -->
<div class="toggle-container">
  <label class="switch">
    <input type="checkbox" [checked]="showDevTest()" (change)="toggleDevTest()" />
    <span class="slider"></span>
  </label>
  <span class="toggle-label">Dev/Test Toggle</span>
</div>

<div class="board-container" (mousemove)="onMouseMove($event)">
  <div class="board-content">
    <!-- Header Row (grid) -->
    <div class="sprint-header" [style.gridTemplateColumns]="getGridTemplateColumns()">
      <div class="sprint-header-cell feature-label">Feature</div>
      <div class="sprint-header-cell parking-lot-col">Parking Lot</div>
      <div class="sprint-header-cell" *ngFor="let sprint of getDisplayedSprints()">
        <div class="sprint-name">{{ sprint.name }}</div>
        <div class="sprint-totals">
          <span *ngIf="showDevTest()" class="dev">Dev: {{ getSprintTotals(sprint.id).dev }}</span>
          <span *ngIf="showDevTest()" class="test"
            >Test: {{ getSprintTotals(sprint.id).test }}</span
          >
          <span class="total">Total: {{ getSprintTotals(sprint.id).total }}</span>
        </div>
      </div>
    </div>

    <!-- Feature Rows -->
    <div
      class="feature-row"
      *ngFor="let feature of board().features"
      [style.gridTemplateColumns]="getGridTemplateColumns()"
    >
      <!-- Feature Name -->
      <div class="feature-name">
        <h3>{{ feature.title }}</h3>
        <span class="feature-total">Total: {{ getFeatureTotal(feature) }} pts</span>
      </div>

      <!-- Parking Lot -->
      <div class="sprint-column">
        <div
          cdkDropList
          [id]="'feature_' + feature.id + '_parkingLot'"
          [cdkDropListData]="getParkingLotStories(feature)"
          [cdkDropListConnectedTo]="getConnectedLists(feature.id)"
          class="story-list"
          (cdkDropListDropped)="drop($event)"
        >
          <app-story-card
            *ngFor="let story of getParkingLotStories(feature)"
            [story]="story"
            [parent]="this"
            cdkDrag
          ></app-story-card>
        </div>
      </div>

      <!-- Sprints (each sprint column is a direct grid child for aligned columns) -->
      <ng-container *ngFor="let sprint of getDisplayedSprints()">
        <div class="sprint-column" [attr.data-sprint-id]="sprint.id">
          <div
            cdkDropList
            [id]="'feature_' + feature.id + '_sprint_' + sprint.id"
            [cdkDropListData]="getStoriesInSprint(feature, sprint.id)"
            [cdkDropListConnectedTo]="getConnectedLists(feature.id)"
            class="story-list"
            (cdkDropListDropped)="drop($event)"
          >
            <app-story-card
              *ngFor="let story of getStoriesInSprint(feature, sprint.id)"
              [story]="story"
              [parent]="this"
              cdkDrag
            ></app-story-card>
          </div>
          <div class="sprint-feature-points">
            <div class="points-row">
              <ng-container *ngIf="getFeatureSprintDevTestTotals(feature, sprint.id) as fTotals">
                <span *ngIf="showDevTest() && fTotals.dev > 0" class="dev"
                  >Dev: {{ fTotals.dev }}</span
                >
                <span *ngIf="showDevTest() && fTotals.test > 0" class="test"
                  >Test: {{ fTotals.test }}</span
                >
                <span class="total">Total: {{ fTotals.total }}</span>
              </ng-container>
            </div>
            <div class="sprint-footer-name">{{ sprint.name }}</div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
  <!-- close board-content -->

  <!-- Floating cursor name -->
  <div class="cursor-label" [ngStyle]="{ top: cursorY() + 'px', left: cursorX() + 'px' }">
    {{ cursorName() }}
  </div>
</div>
